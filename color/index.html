<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ESP32 Servo Test</title>
</head>
<body>
  <h1>ESP32 Servo Control via WebSocket</h1>
  
  <!-- IP/Port 입력 폼 -->
  <div>
    <label>ESP32 IP Address:</label>
    <input type="text" id="esp32-ip" placeholder="192.168.0.xxx" />
    <label>Port:</label>
    <input type="text" id="esp32-port" placeholder="3801" />
    <button onclick="connectWebSocket()">Connect</button>
  </div>
  
  <p id="status">WebSocket not connected</p>
  
  <!-- 실제 색상 감지 대신 테스트용 버튼들 -->
  <div>
    <button onclick="sendColor('r')">Send RED (r)</button>
    <button onclick="sendColor('g')">Send GREEN (g)</button>
    <button onclick="sendColor('b')">Send BLUE (b)</button>
    <button onclick="sendColor('w')">Send WHITE (w)</button>
    <button onclick="sendColor('etc')">Send ETC (Not r/g/b/w)</button>
  </div>

  <!-- (참고) 실제 OpenCV.js 카메라 접근 코드는 별도로 구현해야 함 -->
  <!--
    예시 pseudo-code:
    function detectColorFromCamera() {
      // OpenCV.js 로 frame 받아서, HSV 변환 등으로 색상 판단
      let colorResult = ...; // 'r', 'g', 'b', 'w' 중 하나 or 기타
      ws.send(colorResult);
    }
    setInterval(detectColorFromCamera, 100); // 0.1초 주기 검사
  -->

  <script>
    let ws = null;

    function connectWebSocket() {
      const ip = document.getElementById('esp32-ip').value;
      const port = document.getElementById('esp32-port').value;
      const wsUrl = `ws://${ip}:${port}/`;

      ws = new WebSocket(wsUrl);
      ws.onopen = () => {
        document.getElementById('status').innerText = "WebSocket connected";
      };
      ws.onclose = () => {
        document.getElementById('status').innerText = "WebSocket closed";
      };
      ws.onmessage = (event) => {
        console.log("Received from ESP32:", event.data);
      };
      ws.onerror = (err) => {
        document.getElementById('status').innerText = "WebSocket error";
        console.error(err);
      };
    }

    function sendColor(colorChar) {
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(colorChar);
        console.log("Sent color:", colorChar);
      } else {
        alert("WebSocket not connected!");
      }
    }
  </script>
</body>
</html>
